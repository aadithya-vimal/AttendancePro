<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Attendance Pro</title>
    <link rel="icon" type="image/x-icon" href="AttendanceApplication.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Identity Services SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #121212, #1a1a2e); }
        .glow { animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); } to { box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); } }
        .text-gradient { background: linear-gradient(90deg, #a5b4fc, #818cf8); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .login-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .form-field-hidden { max-height: 0; opacity: 0; transform: scaleY(0.8); margin-bottom: 0 !important; padding: 0; overflow: hidden; transition: all 0.3s ease-in-out; }
        .form-field-visible { max-height: 100px; opacity: 1; transform: scaleY(1); transition: all 0.3s ease-in-out; }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4 text-white">

    <div class="w-full max-w-sm">
        <header class="text-center mb-8">
            <div class="inline-block mb-6"><div class="bg-white/5 backdrop-blur-lg rounded-full p-4 shadow-lg glow"><i class="fas fa-calendar-check text-3xl text-gradient"></i></div></div>
            <h1 class="text-3xl md:text-4xl font-bold mb-2 text-gradient">Attendance Pro</h1>
            <p class="text-white/80">Sign in to continue</p>
        </header>
        
        <div class="login-card rounded-xl p-8 shadow-xl">
            <h2 id="form-title" class="text-2xl font-bold text-center mb-6 text-white/90">Welcome</h2>
            
            <!-- NEW: This div is now just a placeholder for the button -->
            <div id="google-signin-button-container"></div>

            <!-- Divider -->
            <div class="flex items-center my-6">
                <div class="flex-grow border-t border-white/20"></div>
                <span class="mx-4 text-white/60 text-sm">OR</span>
                <div class="flex-grow border-t border-white/20"></div>
            </div>

            <!-- Email/Password Form -->
            <form id="emailForm">
                <div class="mb-4">
                    <label for="email" class="block text-white/80 text-sm mb-2">Email</label>
                    <input type="email" id="email" class="w-full bg-white/10 border border-white/30 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/50" required>
                </div>
                <div class="mb-4">
                    <label for="password" class="block text-white/80 text-sm mb-2">Password</label>
                    <input type="password" id="password" class="w-full bg-white/10 border border-white/30 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/50" required>
                </div>
                <div id="confirm-password-field" class="mb-6 form-field-hidden">
                    <label for="confirm-password" class="block text-white/80 text-sm mb-2">Confirm Password</label>
                    <input type="password" id="confirm-password" class="w-full bg-white/10 border border-white/30 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/50">
                </div>
                <button id="submit-button" type="submit" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold py-3 px-4 rounded-lg hover:shadow-lg transition-all">
                    Sign In
                </button>
            </form>
            
            <div id="errorMessage" class="text-red-400 text-sm text-center mt-4"></div>
            
            <div class="mt-6 text-center">
                <p id="toggle-text" class="text-white/60 text-sm">
                    Don't have an account? <a href="#" id="auth-toggle-link" class="text-indigo-400 hover:text-indigo-300">Sign up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithCredential, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDl26G3Iki090KsKYgS3uG4jDdTYU9bLjw",
        authDomain: "attendance-pro-76984.firebaseapp.com",
        projectId: "attendance-pro-76984",
        storageBucket: "attendance-pro-76984.appspot.com",
        messagingSenderId: "1061249192401",
        appId: "1:1061249192401:web:93a7db035a0e14bb2910f0",
        measurementId: "G-WPDEYXTNFY"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // --- Google Sign-In Handler ---
      async function handleCredentialResponse(response) {
        try {
          const idToken = response.credential;
          const credential = GoogleAuthProvider.credential(idToken);
          await signInWithCredential(auth, credential);
          window.location.href = './index.html';
        } catch (error) {
          console.error("Firebase Google sign-in error:", error);
          document.getElementById('errorMessage').textContent = 'Failed to sign in with Google.';
        }
      };

      // NEW: Programmatic initialization of Google Sign-In
      // This waits until the Google library is loaded.
      window.onload = function () {
        google.accounts.id.initialize({
          client_id: "1061249192401-e3in38qaqiqi4avu5pqkjkp86pjnnh9r.apps.googleusercontent.com",
          callback: handleCredentialResponse // Pass the function directly
        });
        google.accounts.id.renderButton(
          document.getElementById("google-signin-button-container"),
          { theme: "outline", size: "large", text: "sign_in_with", shape: "rectangular", logo_alignment: "left" }
        );
      };


      // --- Email/Password Form Logic ---
      const emailForm = document.getElementById('emailForm');
      const submitButton = document.getElementById('submit-button');
      const toggleText = document.getElementById('toggle-text');
      const errorMessageDiv = document.getElementById('errorMessage');
      const confirmPasswordField = document.getElementById('confirm-password-field');
      const confirmPasswordInput = document.getElementById('confirm-password');
      
      let isSignUpMode = false;

      function toggleAuthMode(e) {
        if (e) e.preventDefault();
        isSignUpMode = !isSignUpMode;
        errorMessageDiv.textContent = '';
        
        if (isSignUpMode) {
          submitButton.textContent = 'Sign Up';
          toggleText.innerHTML = 'Already have an account? <a href="#" id="auth-toggle-link" class="text-indigo-400 hover:text-indigo-300">Sign in</a>';
          confirmPasswordField.classList.remove('form-field-hidden');
          confirmPasswordField.classList.add('form-field-visible');
          confirmPasswordInput.required = true;
        } else {
          submitButton.textContent = 'Sign In';
          toggleText.innerHTML = `Don't have an account? <a href="#" id="auth-toggle-link" class="text-indigo-400 hover:text-indigo-300">Sign up</a>`;
          confirmPasswordField.classList.remove('form-field-visible');
          confirmPasswordField.classList.add('form-field-hidden');
          confirmPasswordInput.required = false;
        }
        
        document.getElementById('auth-toggle-link').addEventListener('click', toggleAuthMode);
      }
      
      document.getElementById('auth-toggle-link').addEventListener('click', toggleAuthMode);

      emailForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        errorMessageDiv.textContent = '';

        try {
          if (isSignUpMode) {
            const confirmPassword = confirmPasswordInput.value;
            if (password !== confirmPassword) {
              errorMessageDiv.textContent = 'Passwords do not match.';
              return;
            }
            await createUserWithEmailAndPassword(auth, email, password);
          } else {
            await signInWithEmailAndPassword(auth, email, password);
          }
          window.location.href = './index.html';
        } catch (error) {
          console.error(`Firebase error (${error.code}):`, error.message);
          switch (error.code) {
            case 'auth/invalid-email':
              errorMessageDiv.textContent = 'Please enter a valid email address.';
              break;
            case 'auth/weak-password':
              errorMessageDiv.textContent = 'Password should be at least 6 characters.';
              break;
            case 'auth/email-already-in-use':
              errorMessageDiv.textContent = 'This email is already in use.';
              break;
            case 'auth/invalid-credential':
              errorMessageDiv.textContent = 'Invalid email or password.';
              break;
            default:
              errorMessageDiv.textContent = 'An error occurred. Please try again.';
              break;
          }
        }
      });
    </script>
</body>
</html>

